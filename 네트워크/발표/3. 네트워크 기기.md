# 네트워크 기기

## 네트워크 기기의 처리 범위

*상위 계층을 처리하는 기기는 하위 계층을 처리할 수 있지만 역은 성립하지 않는다.*

애플리케이션 계층: L7 스위치

인터넷 계층: 라우터, L3 스위치

데이터 링크 계층: L2 스위치, 브리지

물리 계층: NIC, 리피터, AP

---

## 애플리케이션 계층

### L7 스위치

> 여러 장비를 연결, 데이터 통신을 중재, 목적지가 연결된 포트로 전기 신호를 보내 데이터를 전송
> 
- 랜을 구성할 때 단말기간 스위칭 기능이 있는 통신망 중계 장치
- MAC 주소 테이블을 가지고 있어 목적지 MAC 주소를 가진 장비가 연결된 포트로 데이터 전송
    - 스위치에 패킷이 들어오면 MAC주소 테이블을 확인하고 해당 포트에 패킷 전달
    - 테이블에 없으면 모든 포트에 같은 내용의 패킷을 전달 → 플러딩
- 로드밸런서 라고도 불린다
    - 클라이언트로부터 오는 요청을 여러 서버로 나누어 부하를 분산한다.
>
- 로드 밸런싱 방법
    
    **정적 로드 밸런싱**
    
    > 현재 서버 상태와 무관하게 고정된 규칙에 따라 로드 밸런싱
    
    - 라운드 로빈
    
      - 클라이언트의 요청을 순서대로 분배하여 처리한다.
      - 동일한 스펙을 가진 여러 대의 서버가 서버 팜에 있을 때 적합하다.
      - 서버와의 연결(세션)이 오래 지속되지 않는 경우에 적합하다.
    
    - 가중 라운드 로빈
    
      - 각각의 서버마다 가중치가 있으며, 이 값이 높은 서버에 클라이언트 요청을 우선적으로 배분한다.
      - 서버의 트래픽 처리 능력이 상이한 경우 적합하다.
    
    - IP 해시
    
      - 클라이언트 IP 주소에 대해 해싱을 하여 로드를 분배한다.
      - 사용자가 항상 동일한 서버로 연결된다.
    
    **동적 로드 밸런싱**
    
    > 현재 서버의 상태를 검사하여 로드 밸런싱
    
    - 최소 연결
    
      - 요청이 들어온 시점 기준 가장 적은 연결 상태를 보이는 서버에 우선적으로 트래픽을 배분한다.
      - 세션이 길어지거나 트래픽 분배가 일정하지 않은 경우 적합하다.
    
    - 최소 응답 시간
    
      - 서버의 응답 시간과 연결 상태를 결합하여 최상의 서버를 결정한다.
    
    - 리소스 기반
    
      - 각 서버의 컴퓨팅 용량, 메모리 등의 서버 리소스의 사용량을 계산하여 로드 밸런싱

### 네트워크 계층에 따른 로드 밸런서 분류

상위 계층의 장비는 하위 계층의 장비가 가지고 있는 기능을 모두 가지고 있다.

### L4 로드밸런서 (전송계층)

> 네트워크 계층(IP), 전송계층(TCP, UDP)의 정보를 바탕으로 로드를 분산한다.
> 

IP주소, 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다.

장점

- 데이터 안을 들여다 보지 않고 패킷 레벨에서 로드를 분산하기 때문에 속도가 빠르고 효율이 좋다.
- 데이터를 복호화할 필요가 없어 안전하다.
- 가격이 저렴하다.

단점

- 패킷을 들여다볼 수 없어 섬세한 라우팅이 불가능하다.
- 사용자의 IP가 수시로 바뀐다면 연속적인 서비스 제공이 어렵다.

한 대의 서버에 각기 다른 포트번호를 부여하여 다수의 서버 프로그램을 운영한다면?

→ 최소 L4 로드밸런서 이상을 사용해야 한다.

### L7 로드밸런서 (응용계층)

> 응용 계층에서 HTTP 헤더, 쿠키 등 사용자의 요청을 기준으로 로드를 분산한다.
> 

장점

- TCP, UDP는 물론 HTTP 계층의 정보를 바탕으로 섬세한 로드 밸런싱이 가능하다.
- 캐싱 기능이 있다.
- 비정상적인 트래픽을 사전에 필터링 할 수 있다.

단점

- 패킷의 내용을 복호화해야 하기 때문에 더 높은 비용을 지불해야 한다.
- 클라이언트가 로드밸런서와 인증서를 공유해야 하기 때문에 보안 상의 위험성이 있다.

---

## 인터넷 계층

### 라우터

> 여러 개의 네트워크를 연결, 분할, 구분하는 역할
다른 네트워크의 장치와 통신할 때 패킷 소모를 최소화, 경로를 최적화
> 

라우팅 테이블에 경로 정보를 등록하여 데이터를 전송

### L3 스위치

> L2 스위치 + 라우팅 기능
> 

IP 주소를 기반으로 라우팅한다.

---

## 데이터 링크 계층

### L2 스위치

> MAC 주소 테이블을 통해 장치들의 MAC 주소를 관리
연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당한다.
> 

IP 주소를 이해하지 못해 IP 주소 기반 라우팅은 불가능하다.

### 브리지

> 두 개의 근거리 통신망(LAN)을 상호 접속할 수 있도록 하는 통신망 연결 장치
> 

포트와 포트 사이의 다리 역할을 한다.

MAC 주소를 MAC 주소 테이블로 관리한다.

---

## 물리 계층

### NIC(Network Interface Card)

> 2대 이상의 컴퓨터 네트워크를 구성하는 데 사용
빠른 속도로 데이터를 송수신할 수 있도록 컴퓨터 내에 설치하는 확장 카드
> 

0과 1로 이루어진 비트열을 전기 신호로 변환한다.

고유의 식별번호인 MAC 주소를 가지고 있다.

- MAC 주소란?
    - 이더넷의 물리적인 주소, 랜 카드마다 고유한 번호가 할당된다.
    - 앞 24비트는 랜 카드 제조사 번호 + 뒤 24비트는 제조사가 랜 카드에 붙인 일련번호
    - 목적지, 출발지 MAC 주소 + 유형 → 이더넷 헤더 구성
    - 트레일러: 데이터 전송 도중 오류가 발생하는지 확인
    - 이더넷 헤더 + 데이터 + 트레일러 → 프레임

### 리피터

> 약해진 신호를 증폭하여 다른 쪽으로 전달하는 장치
> 

광케이블이 보급됨에 따라 현재는 잘 쓰이지 않는다.

### AP

> 패킷을 복사하는 기기
> 

흔히 사용하는 공유기가 AP에 속한다.

---

## 정리

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbs1TWi%2Fbtq2saG7PZK%2Fox7crzXsxEP3FSgOkijn6k%2Fimg.png)

**컴퓨터**

- URL 입력 → 캡슐화가 시작
- HTTP 프로토콜을 사용하여 전송 계층으로 메시지가 보내진다.
- 전송 계층에서는 데이터에 TCP 헤더가 붙어 세그먼트가 된다.
- 네트워크 계층에서는 전달받은 세그먼트에 IP 헤더가 붙는다. → IP 패킷
    - 출발지 IP, 목적지 IP주소가 추가된다.
- 데이터 링크 계층에서는 이더넷 헤더가 추가된다. → 이더넷 프레임
    - 출발지, 목적지 MAC 주소 추가
- 물리 계층에서 랜카드를 이용하여 전기 신호로 변환된다.

---

### 스위치와 라우터에서의 데이터 전달, 처리

**스위치에서**

데이터 링크 계층에서 데이터를 전기 신호로 변환하여 라우터로 전송한다.

**라우터에서**

데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.

비교 후 같으면 이더넷 헤더와 트레일러를 분리한다.(역캡슐화)

네트워크 계층에 전달 후 라우팅 테이블과 목적지 IP 주소 비교

라우팅 테이블에서 목적지 IP 주소의 경로를 알 수 있으면 라우팅

라우터 B는 데이터가 도착하면 목적지 MAC 주소와 자신의 MAC 주소 비교

비교 후 같으면 이더넷 헤더와 트레일러 분리(역캡슐화)

데이터가 스위치 B로 전달 → 웹 서버에 데이터를 전기 신호로 전달

---

### 웹 서버에서 데이터 전달, 처리

물리 계층에서 전기 신호로 변환된 데이터 수신

데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소 비교

비교 후 같으면 이더넷 헤더와 트레일러 분리

네트워크 계층에 전달 후 라우팅 테이블과 웹서버 IP 주소 비교

같으면 IP 헤더 분리 후 전송 계층으로 전송

목적지 포트 번호 확인

TCP 헤더 분리, 응용 계층에 전달

애플리케이션에서 사용