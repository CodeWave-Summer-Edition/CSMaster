## 운영체제의 역할

| 컴퓨터 하드웨어 위에 설치되어 사용자, 소프트웨어, 하드웨어를 연결



- 목적
    - 컴퓨터 시스템을 편리하게 사용할 수 있는 환경(illusion) 제공
    - 컴퓨터 시스템의 자원을 효율적으로 관리, 보호
- 기능
    - cpu 스케줄링, 프로세스 관리
    - 메모리 관리
    - 디스크 파일 관리, 스케줄링
    - I/O 디바이스 관리

---

## 운영체제의 구조

- GUI
- 시스템콜
- 커널
- 드라이버


### 시스템콜

운영체제가 커널에 접근하기 위한 인터페이스

유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 사용한다.

대표적으로 I/O 요청이 필요할 때 시스템콜을 통해 커널 함수를 호출하여 유저 모드에서 커널 모드로 변환된다.

추상화 계층이기 때문에 네트워크 통신, 데이터베이스 등 low level에 대해 신경 쓰지 않고 프로그램을 구현할 수 있다.

### 인터럽트(넓은 의미)

- 인터럽트(하드웨어 인터럽트)
    - ex) I/O 명령 수행 후 cpu에게 알려줄 때 인터럽트를 건다
    - 타이머 인터럽트로 cpu 독점을 막음
- 트랩(소프트웨어 인터럽트)
    - Exception: 프로그램이 오류를 범한 경우
    - System call: 프로그램이 커널 함수를 호출

인터럽트 벡터: 인터럽트 서비스 루틴 주소를 가지고 있다

인터럽트 서비스 루틴: 해당 인터럽트를 처리하는 커널 함수

### Mode bit

cpu가 운영체제와 사용자 프로그램을 실행할 때를 구분할 필요가 있다.

사용자 프로그램은 악성 프로그램일 수도 있기 때문(ex 무한루프, 에러)

- 1 사용자 모드: 사용자 프로그램 수행
- 0 모니터 모드(커널모드, 시스템 모드): OS 코드 수행
- 중요한 명령어는 priviliged instruction으로 규정한다. (I/O 등)
- 인터럽트 발생 시 mode bit을 0으로
- 사용자 프로그램으로 넘길 때 mode bit을 1로



### CPU

> 메모리에 저장된 명령어들을 순서대로 불러와서 실행하는 장치
> 


**제어장치(CU)**

- 입출력장치 간 통신 제어
- 명령어 해석, 데이터 처리 순서 결정

**레지스터**

- cpu 내부의 매우 빠른 임시기억장치
- 메모리보다 수십 배에서 수백 배까지 빠르다.

**산술논리연산장치(ALU)**

- 산술, 논리 연산 실행

**인출**

첫 번째 단계인 인출(Fetch)은 프로그램의 메모리에서 명령어를 불러온다.

**해독**

두 번째 단계인 해독(Decode)은 인출 단계에서 가져온 명령어를 해독하여 명령어 내의 데이터 정보와 연산 정보를 추출한 뒤, 중앙처리 장치 내의 각 장치에 적절한 제어신호를 보내 연산, 처리에 대한 준비를 하는 단계이다.

**실행**

실행(Execute)은 명령어에서 추출한 두 데이터와 연산 정보를 이용해 실제로 연산을 하는 단계를 말한다. 연산이 끝난 결과는 곧바로 다음 명령어에서 사용될지, 그렇지 않을지에 따라 메모리 단계로 갈지, 라이트백 단계로 갈지 결정된다.

**메모리**

네 번째 단계인 메모리(Memory)는 연산결과가 다음 명령어에 바로 사용되지 않는다면, 결과를 메모리에 저장하는 것을 말한다.

**라이트백**

연산의 마지막 단계인 라이트백(Write-Back)은 이전 명령어의 연산 결과가 다음 명령어의 입력 데이터로 사용될 경우, 계산 결과를 레지스터에 다시 쓰는 것을 말한다.

### DMA 컨트롤러

- 고속 입출력 장치의 경우 인터럽트가 너무 자주 걸림 → overhead 증가
- CPU 중재 없이 device controller가 device의 buffer storage 내용을 메모리에 직접 전송
- 바이트 단위가 아닌 block 단위로 인터럽트 발생

### 타이머

- 무한루프를 도는 프로그램이 있으면 운영체제가 cpu를 뺐어 오기 곤란하다.
- 결국 운영체제도 소프트웨어이기 때문
- 하드웨어적인 도움을 받는다 → 타이머
- 일정 시간 후 인터럽트를 발생시켜 운영체제에게 제어권 넘김

### 디바이스 컨트롤러

- 해당 I/O를 관리하는 일종의 작은 cpu
- ex) 키보드 입력이 들어오면 cpu에게 인터럽트를 건다
- 버퍼에서 값을 읽어 메모리에 쓴다
